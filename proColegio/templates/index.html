<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Inicio de sesi贸n - Colegio Pablo Neruda</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
  <header>
    <img src="{{ url_for('static', filename='img/pabloneruda colegio.jpeg') }}" alt="Foto del Colegio Pablo Neruda">
  </header>

  <section class="login-container">
    <div class="login-right">
      <h1>INSTITUCIN EDUCATIVA PABLO NERUDA</h1>
      <div id="fecha"></div>
      <h2>INICIAR SESIN</h2>
      <input type="text" id="emailInput" placeholder="EMAIL (USUARIO)">
      <input type="password" id="passwordInput" placeholder="TELFONO (CONTRASEA)">
      <p>驴Olvidaste la contrase帽a?</p>
      <button onclick="handleLogin()">INGRESAR</button>
      <div class="quote">"Formamos ciudadanos con calidad, respeto y tolerancia"</div>
    </div>
  </section> <footer>
    <img src="{{ url_for('static', filename='img/logo.jpeg') }}" alt="Logo del Colegio Pablo Neruda">
    <p><strong> Colegio Pablo Neruda - C煤cuta</strong></p>
    <p> Calle 12 #5-78, Barrio Centro, C煤cuta, Norte de Santander</p>
    <p> (7) 582 3421 |  WhatsApp: +57 313 456 7890</p>
    <p>锔 contacto@colegiopabloneruda.edu.co</p>
    <p>
       
      <a href="https://www.facebook.com/ColegioPabloNerudaCucuta" target="_blank">Facebook</a> |
      <a href="https://www.instagram.com/ColegioPabloNerudaCucuta" target="_blank">Instagram</a> |
      <a href="https://wa.me/573134567890" target="_blank">WhatsApp</a>
    </p>
  </footer>

  <script>
    // Actualizar fecha al cargar
    window.onload = function () {
      const fechaElemento = document.getElementById("fecha");
      const hoy = new Date();
      const opciones = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
      fechaElemento.textContent = hoy.toLocaleDateString('es-ES', opciones);
    };

    // Nueva funci贸n para manejar el inicio de sesi贸n con el backend
    async function handleLogin() {
      const email = document.getElementById("emailInput").value.trim();
      const password = document.getElementById("passwordInput").value.trim();

      if (email === "" || password === "") {
        alert("Por favor, ingresa tu email y contrase帽a (tel茅fono).");
        return;
      }

      try {
        // Fetch call to the Flask /api/login route
        const response = await fetch("{{ url_for('login') }}", { 
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ email: email, password: password })
        });

        const result = await response.json();

        if (result.success) {
          // Store user's name and redirect
          localStorage.setItem("usuarioNombre", result.nombre);
          localStorage.setItem("usuarioApellido", result.apellido);
          // Redirect to the 'inicio' route handled by Flask
          window.location.href = "{{ url_for('inicio') }}"; 
        } else {
          alert(result.message || "Error al iniciar sesi贸n. Verifica tus credenciales.");
        }
      } catch (error) {
        console.error("Error en el proceso de login:", error);
        alert("Ocurri贸 un error al intentar iniciar sesi贸n. Revisa la consola para m谩s detalles.");
      }
    }

    // La funci贸n original iniciarSesion() ya no es necesaria con la l贸gica de handleLogin()
    /*
    function iniciarSesion() {
      const usuario = document.getElementById("usuario").value.trim(); // Asumiendo que tienes estos IDs
      const contrasena = document.getElementById("contrasena").value.trim(); // Asumiendo que tienes estos IDs

      if (usuario === "" || contrasena === "") {
        alert("Por favor, completa ambos campos para iniciar sesi贸n.");
        return;
      }

      // Guardar datos en localStorage (esto es lo que hac铆a antes)
      localStorage.setItem("usuario", usuario);
      localStorage.setItem("contrasena", contrasena);

      // Redirigir al inicio (esto es una navegaci贸n directa, sin login real)
      window.location.href = "inicio.html"; 
    }
    */
  </script>
</body>
</html>